<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Handy/Number.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-- |</span>
<a name="line-2"></a><span class='hs-comment'>-- Module:       $HEADER$</span>
<a name="line-3"></a><span class='hs-comment'>-- Description:  Handy functions for manipulating numbers.</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- Handy functions for manipulating numbers.</span>
<a name="line-6"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Handy</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span>
<a name="line-7"></a>    <span class='hs-layout'>(</span>
<a name="line-8"></a>    <span class='hs-comment'>-- * Modular arithmetic</span>
<a name="line-9"></a>      <span class='hs-varid'>egcd</span>
<a name="line-10"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>modInv</span>
<a name="line-11"></a>    <span class='hs-comment'>-- * Arithmetic</span>
<a name="line-12"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sqrtBig</span>
<a name="line-13"></a>    <span class='hs-comment'>-- * Often used seqences</span>
<a name="line-14"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>diagonal</span>
<a name="line-15"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>fibs</span>
<a name="line-16"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>primes</span>
<a name="line-17"></a>    <span class='hs-comment'>-- * Factorization</span>
<a name="line-18"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>factor</span>
<a name="line-19"></a>    <span class='hs-comment'>-- * Encoding/Decoding</span>
<a name="line-20"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>enc1</span><span class='hs-layout'>,</span> <span class='hs-varid'>dec1</span>
<a name="line-21"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>enc2</span><span class='hs-layout'>,</span> <span class='hs-varid'>dec2</span>
<a name="line-22"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>encodeBase</span><span class='hs-layout'>,</span> <span class='hs-varid'>decodeBase</span>
<a name="line-23"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>encodeBij</span><span class='hs-layout'>,</span> <span class='hs-varid'>decodeBij</span>
<a name="line-24"></a>    <span class='hs-comment'>-- * Convenience functions/values</span>
<a name="line-25"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>binBase</span>
<a name="line-26"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>octBase</span>
<a name="line-27"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>decBase</span>
<a name="line-28"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>hexBase</span>
<a name="line-29"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-30"></a>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>***</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-comment'>-- Available in Prelude...</span>
<a name="line-34"></a><span class='hs-comment'>-- -- | Standard GCD</span>
<a name="line-35"></a><span class='hs-comment'>-- gcd :: Integral a =&gt; a -&gt; a -&gt; a</span>
<a name="line-36"></a><span class='hs-comment'>-- gcd a 0 = abs a</span>
<a name="line-37"></a><span class='hs-comment'>-- gcd a b = gcd b (a `mod` b)</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="egcd'"></a><span class='hs-comment'>-- Auxiliary function</span>
<a name="line-40"></a><span class='hs-definition'>egcd'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-41"></a><span class='hs-definition'>egcd'</span> <span class='hs-varid'>a</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-42"></a><span class='hs-definition'>egcd'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-comment'>-</span> <span class='hs-varid'>d</span> <span class='hs-varop'>*</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-43"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>`quotRem`</span> <span class='hs-varid'>b</span>
<a name="line-44"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>egcd'</span> <span class='hs-varid'>b</span> <span class='hs-varid'>m</span>
<a name="line-45"></a>
<a name="line-46"></a><a name="egcd"></a><span class='hs-comment'>-- | Extended Euclidean algorithm (Greatest Common Divisor).</span>
<a name="line-47"></a><span class='hs-comment'>--</span>
<a name="line-48"></a><span class='hs-comment'>-- &gt; a*x + b*y == g &amp;&amp; g == gcd a b where (x,y,g) = egcd a b</span>
<a name="line-49"></a><span class='hs-definition'>egcd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-50"></a><span class='hs-definition'>egcd</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>*</span> <span class='hs-varid'>g</span><span class='hs-layout'>,</span><span class='hs-varid'>i</span> <span class='hs-varop'>*</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-varid'>i</span> <span class='hs-varop'>*</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-51"></a>    <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>signum</span> <span class='hs-varid'>g</span>
<a name="line-52"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>egcd'</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-53"></a>
<a name="line-54"></a><a name="sqrtBig"></a><span class='hs-comment'>-- | For given @n@ finds largest @m@ such that @m^2 &lt;= n@. Newtons method.</span>
<a name="line-55"></a><span class='hs-comment'>--</span>
<a name="line-56"></a><span class='hs-comment'>-- &gt;&gt;&gt; sqrtBig 121</span>
<a name="line-57"></a><span class='hs-comment'>-- 11</span>
<a name="line-58"></a><span class='hs-comment'>-- &gt;&gt;&gt; sqrtBig 120</span>
<a name="line-59"></a><span class='hs-comment'>-- 10</span>
<a name="line-60"></a><span class='hs-definition'>sqrtBig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-61"></a><span class='hs-definition'>sqrtBig</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>head</span> <span class='hs-varop'>.</span> <span class='hs-varid'>dropWhile</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>)</span><span class='hs-varop'>.</span><span class='hs-layout'>(</span><span class='hs-varop'>^</span><span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>iterate</span> <span class='hs-varid'>f</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>where</span>
<a name="line-62"></a>    <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-varid'>n</span> <span class='hs-varop'>`div`</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varop'>`div`</span> <span class='hs-num'>2</span>
<a name="line-63"></a>
<a name="line-64"></a><a name="modInv"></a><span class='hs-comment'>-- for m &lt; 0:</span>
<a name="line-65"></a><span class='hs-comment'>--   as 1 = 0 + 1</span>
<a name="line-66"></a><span class='hs-comment'>--   and m = 0</span>
<a name="line-67"></a><span class='hs-comment'>--   so 1 = m + 1</span>
<a name="line-68"></a><span class='hs-comment'>-- example:</span>
<a name="line-69"></a><span class='hs-comment'>--   modInv 2 (-13) = Just (-6)</span>
<a name="line-70"></a><span class='hs-comment'>--   2 * (-6) = (-12)</span>
<a name="line-71"></a><span class='hs-comment'>--   (-12) `mod` (-13) = (-12)</span>
<a name="line-72"></a><span class='hs-comment'>--</span>
<a name="line-73"></a><span class='hs-comment'>-- | Modular inverse.</span>
<a name="line-74"></a><span class='hs-comment'>--</span>
<a name="line-75"></a><span class='hs-comment'>-- &gt; (a * i) `mod` m == 1 where Just i = a `modInv` m</span>
<a name="line-76"></a><span class='hs-definition'>modInv</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-77"></a><span class='hs-definition'>modInv</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>g</span> <span class='hs-varop'>==</span> <span class='hs-num'>1</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>`mod`</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyword'>where</span>
<a name="line-78"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>egcd</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="primes"></a><span class='hs-comment'>-- | List of prime numbers.</span>
<a name="line-81"></a><span class='hs-definition'>primes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Integer</span><span class='hs-keyglyph'>]</span>
<a name="line-82"></a><span class='hs-definition'>primes</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-conop'>:</span><span class='hs-num'>3</span><span class='hs-conop'>:</span> <span class='hs-varid'>filter</span> <span class='hs-varid'>isPrime</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>5</span><span class='hs-layout'>,</span><span class='hs-num'>7</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>where</span>
<a name="line-83"></a>    <span class='hs-varid'>isPrime</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varop'>$</span> <span class='hs-varid'>takeWhile</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;=</span><span class='hs-varid'>bound</span><span class='hs-layout'>)</span> <span class='hs-varid'>primes</span> <span class='hs-keyword'>where</span>
<a name="line-84"></a>        <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>notElem</span> <span class='hs-num'>0</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>mod</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-85"></a>        <span class='hs-varid'>bound</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sqrtBig</span> <span class='hs-varid'>n</span>
<a name="line-86"></a>
<a name="line-87"></a><a name="rho"></a><span class='hs-comment'>-- Rho Algorithm from Wikipedia:</span>
<a name="line-88"></a><span class='hs-comment'>-- The algorithm takes as its inputs @n@, the integer to be factored;</span>
<a name="line-89"></a><span class='hs-comment'>-- and @g(x)@, a polynomial @p(x)@ computed modulo @n@.</span>
<a name="line-90"></a><span class='hs-comment'>-- This will ensure that if @p|n@, and @x ≡ y mod p@, then @g(x) ≡ g(y) mod p@.</span>
<a name="line-91"></a><span class='hs-comment'>-- In the original algorithm, @g(x) = (x2 - 1) mod n@, but nowadays it is more</span>
<a name="line-92"></a><span class='hs-comment'>-- common to use @g(x) = (x2 + 1) mod n@. The output is either a non-trivial</span>
<a name="line-93"></a><span class='hs-comment'>-- factor of @n@, or failure. It performs the following steps:[2]</span>
<a name="line-94"></a><span class='hs-comment'>--</span>
<a name="line-95"></a><span class='hs-comment'>-- &gt; x ← 2; y ← 2; d ← 1;</span>
<a name="line-96"></a><span class='hs-comment'>-- &gt; While d = 1:</span>
<a name="line-97"></a><span class='hs-comment'>-- &gt;     x ← g(x)</span>
<a name="line-98"></a><span class='hs-comment'>-- &gt;     y ← g(g(y))</span>
<a name="line-99"></a><span class='hs-comment'>-- &gt;     d ← gcd(|x - y|, n)</span>
<a name="line-100"></a><span class='hs-comment'>-- &gt; If d = n, return failure.</span>
<a name="line-101"></a><span class='hs-comment'>-- &gt; Else, return d.</span>
<a name="line-102"></a><span class='hs-comment'>--</span>
<a name="line-103"></a><span class='hs-comment'>-- Note that *this algorithm may fail* to find a nontrivial factor even</span>
<a name="line-104"></a><span class='hs-comment'>-- when @n@ is composite. In that case, you can try again, using a starting</span>
<a name="line-105"></a><span class='hs-comment'>-- value other than 2 or a different @g(x)@. The name ρ algorithm comes from</span>
<a name="line-106"></a><span class='hs-comment'>-- the fact that the values of @x (mod d)@ eventually repeat with period @d@,</span>
<a name="line-107"></a><span class='hs-comment'>-- resulting in a ρ shape when you graph the values.</span>
<a name="line-108"></a><span class='hs-definition'>rho</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Integer</span>
<a name="line-109"></a><span class='hs-definition'>rho</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varop'>.</span> <span class='hs-varid'>head</span>
<a name="line-110"></a>    <span class='hs-varop'>.</span> <span class='hs-varid'>dropWhile</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-varop'>==</span><span class='hs-layout'>)</span>
<a name="line-111"></a>    <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>gcd</span> <span class='hs-varid'>n</span> <span class='hs-varop'>.</span> <span class='hs-varid'>abs</span> <span class='hs-varop'>.</span> <span class='hs-varid'>uncurry</span> <span class='hs-layout'>(</span><span class='hs-comment'>-</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-112"></a>    <span class='hs-varop'>.</span> <span class='hs-varid'>tail</span> <span class='hs-varop'>$</span> <span class='hs-varid'>iterate</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varop'>***</span> <span class='hs-varid'>g</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-layout'>,</span><span class='hs-num'>2</span><span class='hs-layout'>)</span>
<a name="line-113"></a>    <span class='hs-keyword'>where</span>
<a name="line-114"></a>    <span class='hs-varid'>g</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-varop'>*</span><span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mod`</span> <span class='hs-varid'>n</span>
<a name="line-115"></a>    <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>x</span> <span class='hs-varop'>==</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span>
<a name="line-116"></a>
<a name="line-117"></a><span class='hs-comment'>-- coprime :: Integer -&gt; Integer -&gt; Bool</span>
<a name="line-118"></a><span class='hs-comment'>-- coprime m n = gcd m n == 1</span>
<a name="line-119"></a>
<a name="line-120"></a><a name="factor"></a><span class='hs-comment'>-- | Reasonably fast, but due to the fact that it uses rho function for</span>
<a name="line-121"></a><span class='hs-comment'>-- numbers not divisible by first 1000 primes, resulting list may contain</span>
<a name="line-122"></a><span class='hs-comment'>-- also composites @:-(@.</span>
<a name="line-123"></a><span class='hs-definition'>factor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integer</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Integer</span><span class='hs-keyglyph'>]</span>
<a name="line-124"></a><span class='hs-definition'>factor</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>take</span> <span class='hs-num'>1000</span> <span class='hs-varid'>primes</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-125"></a>    <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-num'>1</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-126"></a>    <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>m</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>p</span> <span class='hs-conop'>:</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>f</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>where</span>
<a name="line-127"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-varop'>`divMod`</span> <span class='hs-varid'>p</span>
<a name="line-128"></a>    <span class='hs-varid'>f</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>g</span> <span class='hs-varid'>n</span>
<a name="line-129"></a>    <span class='hs-varid'>g</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>rho</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>of</span>
<a name="line-130"></a>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span>
<a name="line-131"></a>        <span class='hs-comment'>-- Just x -&gt; g x ++ g (n `div` x)</span>
<a name="line-132"></a>        <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span>
<a name="line-133"></a>
<a name="line-134"></a><a name="fibs"></a><span class='hs-comment'>-- | List of Fibonacci numbers.</span>
<a name="line-135"></a><span class='hs-definition'>fibs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Integer</span><span class='hs-keyglyph'>]</span>
<a name="line-136"></a><span class='hs-definition'>fibs</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span> <span class='hs-conop'>:</span> <span class='hs-num'>1</span> <span class='hs-conop'>:</span> <span class='hs-varid'>zipWith</span> <span class='hs-layout'>(</span><span class='hs-varop'>+</span><span class='hs-layout'>)</span> <span class='hs-varid'>fibs</span> <span class='hs-layout'>(</span><span class='hs-varid'>tail</span> <span class='hs-varid'>fibs</span><span class='hs-layout'>)</span>
<a name="line-137"></a>
<a name="line-138"></a><a name="diagonal"></a><span class='hs-comment'>-- | Diagonal enumeration of pairs of natural numbers.</span>
<a name="line-139"></a><span class='hs-comment'>-- Every pair is guaranteed to occur at finite position</span>
<a name="line-140"></a><span class='hs-comment'>-- in the list. Usable mostly with types representing unbound numbers.</span>
<a name="line-141"></a><span class='hs-definition'>diagonal</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-142"></a><span class='hs-definition'>diagonal</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>n</span><span class='hs-comment'>-</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>0</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>0</span><span class='hs-keyglyph'>..</span><span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>]</span>
<a name="line-143"></a>
<a name="line-144"></a>
<a name="line-145"></a><a name="enc1"></a><span class='hs-comment'>-- | Encode tuple of natural numbers into position on diagonal enumeration.</span>
<a name="line-146"></a><span class='hs-comment'>--</span>
<a name="line-147"></a><span class='hs-comment'>-- prop&gt; map (uncurry enc1) diagonal == [0..]</span>
<a name="line-148"></a><span class='hs-definition'>enc1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-149"></a><span class='hs-definition'>enc1</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-varop'>*</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-varid'>y</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`div`</span> <span class='hs-num'>2</span> <span class='hs-varop'>+</span> <span class='hs-varid'>x</span>
<a name="line-150"></a>
<a name="line-151"></a><a name="dec1"></a><span class='hs-comment'>-- | Decoding for 'enc1' encoding.</span>
<a name="line-152"></a><span class='hs-comment'>--</span>
<a name="line-153"></a><span class='hs-comment'>-- For natural numbers:</span>
<a name="line-154"></a><span class='hs-comment'>--</span>
<a name="line-155"></a><span class='hs-comment'>-- prop&gt; dec1 . uncurry enc1 = id</span>
<a name="line-156"></a><span class='hs-comment'>--</span>
<a name="line-157"></a><span class='hs-comment'>-- prop&gt; uncurry enc1 . dec1 = id</span>
<a name="line-158"></a><span class='hs-definition'>dec1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-159"></a><span class='hs-definition'>dec1</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span><span class='hs-layout'>,</span><span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-160"></a><span class='hs-definition'>dec1</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-varop'>+</span><span class='hs-varid'>d</span><span class='hs-comment'>-</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-161"></a>    <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sqrtBig</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-varop'>*</span><span class='hs-num'>2</span><span class='hs-layout'>)</span>
<a name="line-162"></a>    <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-comment'>-</span> <span class='hs-varid'>enc1</span> <span class='hs-num'>0</span> <span class='hs-varid'>a</span>
<a name="line-163"></a>    <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-varop'>+</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mod`</span> <span class='hs-varid'>a</span>
<a name="line-164"></a>    <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`div`</span> <span class='hs-varid'>a</span>
<a name="line-165"></a>
<a name="line-166"></a><a name="enc2"></a><span class='hs-comment'>-- | Alternate encoding of tuples of natural numbers.</span>
<a name="line-167"></a><span class='hs-definition'>enc2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-168"></a><span class='hs-definition'>enc2</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>2</span><span class='hs-varop'>^</span><span class='hs-varid'>x</span> <span class='hs-varop'>*</span> <span class='hs-layout'>(</span><span class='hs-varid'>y</span><span class='hs-varop'>*</span><span class='hs-num'>2</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="dec2"></a><span class='hs-comment'>-- | Decoding for 'enc2' encoding.</span>
<a name="line-171"></a><span class='hs-comment'>-- For natural numbers:</span>
<a name="line-172"></a><span class='hs-comment'>--</span>
<a name="line-173"></a><span class='hs-comment'>-- prop&gt; dec2 . uncurry enc2 = id</span>
<a name="line-174"></a><span class='hs-comment'>--</span>
<a name="line-175"></a><span class='hs-comment'>-- prop&gt; uncurry enc2 . dec2 = id</span>
<a name="line-176"></a><span class='hs-definition'>dec2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-177"></a><span class='hs-definition'>dec2</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-178"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-num'>0</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>where</span>
<a name="line-179"></a>        <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>m</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-varop'>+</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>b</span> <span class='hs-varop'>`divMod`</span> <span class='hs-num'>2</span>
<a name="line-180"></a>    <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>y'</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`div`</span> <span class='hs-num'>2</span>
<a name="line-181"></a>
<a name="line-182"></a><a name="encodeBase"></a><span class='hs-comment'>-- | Encode natural number in base @(length s)@, using symbols from @s@.</span>
<a name="line-183"></a><span class='hs-comment'>-- Provided @s@ must be of length no less than 2.</span>
<a name="line-184"></a><span class='hs-comment'>--</span>
<a name="line-185"></a><span class='hs-comment'>-- &gt;&gt;&gt; encodeBase ['0'..'9'] 100</span>
<a name="line-186"></a><span class='hs-comment'>-- "100"</span>
<a name="line-187"></a><span class='hs-comment'>-- &gt;&gt;&gt; encodeBase "01" 5</span>
<a name="line-188"></a><span class='hs-comment'>-- "101"</span>
<a name="line-189"></a><span class='hs-comment'>-- &gt;&gt;&gt; encodeBase "0123456789abc" (6*9)</span>
<a name="line-190"></a><span class='hs-comment'>-- "42"</span>
<a name="line-191"></a><span class='hs-comment'>--</span>
<a name="line-192"></a><span class='hs-comment'>-- It is not a bijection due to \"leading zeros problem\".</span>
<a name="line-193"></a><span class='hs-definition'>encodeBase</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-194"></a><span class='hs-definition'>encodeBase</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>reverse</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>where</span>
<a name="line-195"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-varid'>length</span> <span class='hs-varid'>s</span>
<a name="line-196"></a>    <span class='hs-varid'>f</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-197"></a>    <span class='hs-varid'>f</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>!!</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>m</span> <span class='hs-conop'>:</span> <span class='hs-varid'>f</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>where</span>
<a name="line-198"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>divMod</span> <span class='hs-varid'>n</span> <span class='hs-varid'>l</span>
<a name="line-199"></a>
<a name="line-200"></a><a name="decodeBase"></a><span class='hs-comment'>-- | Decode natural number in base @(length s)@, using symbols from @s@.</span>
<a name="line-201"></a><span class='hs-comment'>-- Provided @s@ must be of length no less than 2. It is dual to 'encodeBase'.</span>
<a name="line-202"></a><span class='hs-comment'>--</span>
<a name="line-203"></a><span class='hs-comment'>-- &gt;&gt;&gt; decodeBase ['0'..'9'] "101" :: Int</span>
<a name="line-204"></a><span class='hs-comment'>-- 101</span>
<a name="line-205"></a><span class='hs-comment'>-- &gt;&gt;&gt; encodeBase "01" "101" :: Int</span>
<a name="line-206"></a><span class='hs-comment'>-- 5</span>
<a name="line-207"></a><span class='hs-comment'>--</span>
<a name="line-208"></a><span class='hs-comment'>-- It is not a bijection due to \"leading zeros problem\".</span>
<a name="line-209"></a><span class='hs-comment'>--</span>
<a name="line-210"></a><span class='hs-comment'>-- prop&gt; decodeBase s . encodeBase s = id</span>
<a name="line-211"></a><span class='hs-definition'>decodeBase</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-212"></a><span class='hs-definition'>decodeBase</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varop'>.</span> <span class='hs-varid'>reverse</span> <span class='hs-keyword'>where</span>
<a name="line-213"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-varid'>length</span> <span class='hs-varid'>s</span>
<a name="line-214"></a>    <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-varid'>y</span> <span class='hs-varop'>*</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>pos</span> <span class='hs-keyword'>where</span>
<a name="line-215"></a>        <span class='hs-varid'>pos</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>.</span> <span class='hs-varid'>length</span> <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>takeWhile</span> <span class='hs-varid'>s</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span>
<a name="line-216"></a>
<a name="line-217"></a><a name="encodeBij"></a><span class='hs-comment'>-- | Bijectively encode natural numbers into sequence.</span>
<a name="line-218"></a><span class='hs-comment'>-- This is not standard math encoding, but is handy</span>
<a name="line-219"></a><span class='hs-comment'>-- when you need to use space as efficiently as you can.</span>
<a name="line-220"></a><span class='hs-comment'>--</span>
<a name="line-221"></a><span class='hs-comment'>-- Provided @s@ must be non-empty. For single element list</span>
<a name="line-222"></a><span class='hs-comment'>-- it collapses to length-encoding.</span>
<a name="line-223"></a><span class='hs-comment'>--</span>
<a name="line-224"></a><span class='hs-comment'>-- Handy for generating examples:</span>
<a name="line-225"></a><span class='hs-comment'>--</span>
<a name="line-226"></a><span class='hs-comment'>-- &gt; map (encodeBij "aA") [1..]</span>
<a name="line-227"></a><span class='hs-definition'>encodeBij</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-228"></a><span class='hs-definition'>encodeBij</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>reverse</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>where</span>
<a name="line-229"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-varid'>length</span> <span class='hs-varid'>s</span>
<a name="line-230"></a>    <span class='hs-varid'>f</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-231"></a>    <span class='hs-varid'>f</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>!!</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>m</span> <span class='hs-conop'>:</span> <span class='hs-varid'>f</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>where</span>
<a name="line-232"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>divMod</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span>
<a name="line-233"></a>
<a name="line-234"></a><a name="decodeBij"></a><span class='hs-comment'>-- | Decoding for 'encodeBij' encoding.</span>
<a name="line-235"></a><span class='hs-comment'>--</span>
<a name="line-236"></a><span class='hs-comment'>-- For natural numbers and non-empty list:</span>
<a name="line-237"></a><span class='hs-comment'>--</span>
<a name="line-238"></a><span class='hs-comment'>-- prop&gt; encodeBij s . decodeBij s = id</span>
<a name="line-239"></a><span class='hs-comment'>--</span>
<a name="line-240"></a><span class='hs-comment'>-- prop&gt; decodeBij s . encodeBij s = id</span>
<a name="line-241"></a><span class='hs-definition'>decodeBij</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Integral</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-242"></a><span class='hs-definition'>decodeBij</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varop'>.</span> <span class='hs-varid'>reverse</span> <span class='hs-keyword'>where</span>
<a name="line-243"></a>    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-varid'>length</span> <span class='hs-varid'>s</span>
<a name="line-244"></a>    <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-varid'>y</span> <span class='hs-varop'>*</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varop'>.</span> <span class='hs-varid'>map</span> <span class='hs-varid'>pos</span> <span class='hs-keyword'>where</span>
<a name="line-245"></a>        <span class='hs-varid'>pos</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>succ</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>.</span> <span class='hs-varid'>length</span> <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>takeWhile</span> <span class='hs-varid'>s</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-layout'>)</span>
<a name="line-246"></a>
<a name="line-247"></a><a name="binBase"></a><span class='hs-comment'>-- | List of symbols for binary encoding.</span>
<a name="line-248"></a><span class='hs-comment'>-- For use with 'encodeBase' and 'decodeBase'.</span>
<a name="line-249"></a><span class='hs-definition'>binBase</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<a name="line-250"></a><span class='hs-definition'>binBase</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"01"</span>
<a name="line-251"></a>
<a name="line-252"></a><a name="octBase"></a><span class='hs-comment'>-- | List of symbols for octal encoding.</span>
<a name="line-253"></a><span class='hs-comment'>-- For use with 'encodeBase' and 'decodeBase'.</span>
<a name="line-254"></a><span class='hs-definition'>octBase</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<a name="line-255"></a><span class='hs-definition'>octBase</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"01234567"</span>
<a name="line-256"></a>
<a name="line-257"></a><a name="decBase"></a><span class='hs-comment'>-- | List of symbols for decimal encoding.</span>
<a name="line-258"></a><span class='hs-comment'>-- For use with 'encodeBase' and 'decodeBase'.</span>
<a name="line-259"></a><span class='hs-definition'>decBase</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<a name="line-260"></a><span class='hs-definition'>decBase</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"0123456789"</span>
<a name="line-261"></a>
<a name="line-262"></a><a name="hexBase"></a><span class='hs-comment'>-- | List of symbols for hexadecimal encoding.</span>
<a name="line-263"></a><span class='hs-comment'>-- For use with 'encodeBase' and 'decodeBase'.</span>
<a name="line-264"></a><span class='hs-definition'>hexBase</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Char</span><span class='hs-keyglyph'>]</span>
<a name="line-265"></a><span class='hs-definition'>hexBase</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"0123456789abcdef"</span>
</pre></body>
</html>
